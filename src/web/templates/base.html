<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#000000" id="theme-color-meta">
    <meta name="color-scheme" content="dark light">
    <title>{% block title %}X Bot Dashboard{% endblock %}</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://unpkg.com">
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="/static/styles.css">
    
    <!-- Theme initialization (prevent flash) -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 
                (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('theme-color-meta').content = theme === 'dark' ? '#000000' : '#ffffff';
        })();
    </script>
    
    {% block head %}{% endblock %}
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation (Desktop/Tablet) -->
        <nav class="sidebar" id="sidebar">
            <a href="/" class="logo">
                <span class="logo-icon">ùïè</span>
                <span class="logo-text">Bot</span>
            </a>
            
            <ul class="nav-links">
                <li>
                    <a href="/" class="nav-link {% if request.url.path == '/' %}active{% endif %}">
                        <span class="nav-icon">
                            {% if request.url.path == '/' %}
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path d="M21.591 7.146L12.52 1.157c-.316-.21-.724-.21-1.04 0l-9.071 5.99c-.26.173-.409.456-.409.757v13.183c0 .502.418.913.929.913H9.14c.51 0 .929-.41.929-.913v-7.075h3.909v7.075c0 .502.417.913.928.913h6.165c.511 0 .929-.41.929-.913V7.904c0-.301-.158-.584-.409-.758z"/>
                            </svg>
                            {% else %}
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path d="M21.591 7.146L12.52 1.157c-.316-.21-.724-.21-1.04 0l-9.071 5.99c-.26.173-.409.456-.409.757v13.183c0 .502.418.913.929.913h6.638c.511 0 .929-.41.929-.913v-7.075h3.008v7.075c0 .502.418.913.929.913h6.638c.511 0 .929-.41.929-.913V7.904c0-.301-.158-.584-.409-.758zM20 20l-4.5.01V13c0-.502-.418-.913-.929-.913H9.43c-.511 0-.929.41-.929.913l-.01 7.01H4V8.773l8-5.27 8 5.27V20z"/>
                            </svg>
                            {% endif %}
                        </span>
                        <span>Home</span>
                    </a>
                </li>
                <li>
                    <a href="/posts" class="nav-link {% if request.url.path == '/posts' %}active{% endif %}">
                        <span class="nav-icon">
                            {% if request.url.path == '/posts' %}
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path d="M23 3c-6.62-.1-10.38 2.421-13.05 6.03C7.29 12.61 6 17.331 6 22h2c0-1.007.07-2.012.19-3H12c4.1 0 7.48-3.082 7.94-7.054C22.79 10.147 23.17 6.359 23 3zm-7 8h-1.5v2H16c.63-.016 1.2-.08 1.72-.188C16.95 15.24 14.68 17 12 17H8.55c.57-2.512 1.57-4.851 3-6.78 2.16-2.912 5.29-4.911 9.45-5.187C20.95 8.079 19.9 11 16 11zM4 9V6H1V4h3V1h2v3h3v2H6v3H4z"/>
                            </svg>
                            {% else %}
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path d="M23 3c-6.62-.1-10.38 2.421-13.05 6.03C7.29 12.61 6 17.331 6 22h2c0-1.007.07-2.012.19-3H12c4.1 0 7.48-3.082 7.94-7.054C22.79 10.147 23.17 6.359 23 3zm-7 8h-1.5v2H16c.63-.016 1.2-.08 1.72-.188C16.95 15.24 14.68 17 12 17H8.55c.57-2.512 1.57-4.851 3-6.78 2.16-2.912 5.29-4.911 9.45-5.187C20.95 8.079 19.9 11 16 11zM4 9V6H1V4h3V1h2v3h3v2H6v3H4z"/>
                            </svg>
                            {% endif %}
                        </span>
                        <span>Posts</span>
                    </a>
                </li>
                <li>
                    <a href="/analytics" class="nav-link {% if request.url.path == '/analytics' %}active{% endif %}">
                        <span class="nav-icon">
                            {% if request.url.path == '/analytics' %}
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path d="M8.75 21V3h2v18h-2zM18 21V8.5h2V21h-2zM4 21l.004-10h2L6 21H4zm9.248 0v-7h2v7h-2z"/>
                            </svg>
                            {% else %}
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path d="M8.75 21V3h2v18h-2zM18 21V8.5h2V21h-2zM4 21l.004-10h2L6 21H4zm9.248 0v-7h2v7h-2z"/>
                            </svg>
                            {% endif %}
                        </span>
                        <span>Analytics</span>
                    </a>
                </li>
                <li>
                    <a href="/settings" class="nav-link {% if request.url.path == '/settings' %}active{% endif %}">
                        <span class="nav-icon">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path d="M10.54 1.75h2.92l1.57 2.36c.11.17.32.25.53.21l2.53-.59 2.17 2.17-.58 2.54c-.05.2.04.41.21.53l2.36 1.57v2.92l-2.36 1.57c-.17.12-.26.33-.21.53l.58 2.54-2.17 2.17-2.53-.59c-.21-.04-.42.04-.53.21l-1.57 2.36h-2.92l-1.58-2.36c-.11-.17-.32-.25-.52-.21l-2.54.59-2.17-2.17.58-2.54c.05-.2-.03-.41-.21-.53l-2.36-1.57v-2.92L4.1 8.97c.18-.12.26-.33.21-.53L3.73 5.9 5.9 3.73l2.54.59c.2.04.41-.04.52-.21l1.58-2.36zm1.07 2l-.98 1.47c-.51.76-1.43 1.13-2.33.93l-1.6-.37-.79.79.37 1.59c.2.9-.17 1.83-.93 2.33l-1.47.99v1.12l1.47.99c.76.5 1.13 1.43.93 2.33l-.37 1.59.79.79 1.6-.37c.9-.2 1.82.17 2.33.93l.98 1.47h1.12l.98-1.47c.51-.76 1.43-1.13 2.33-.93l1.6.37.79-.79-.37-1.59c-.2-.9.17-1.83.93-2.33l1.47-.99v-1.12l-1.47-.99c-.76-.5-1.13-1.43-.93-2.33l.37-1.59-.79-.79-1.6.37c-.9.2-1.82-.17-2.33-.93l-.98-1.47h-1.12zM12 8c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                            </svg>
                        </span>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
            
            <div class="nav-footer">
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span class="status-text">Active</span>
                </div>
            </div>
        </nav>
        
        <!-- Main content -->
        <main class="main-content">
            <header class="page-header">
                <h1 class="page-title">{% block page_title %}Dashboard{% endblock %}</h1>
                <div class="header-actions">
                    {% block header_actions %}{% endblock %}
                    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
                        <span class="icon-sun">‚òÄÔ∏è</span>
                        <span class="icon-moon">üåô</span>
                    </button>
                </div>
            </header>
            
            <div class="content">
                {% block content %}{% endblock %}
            </div>
        </main>
        
        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <ul class="bottom-nav-links">
                <li>
                    <a href="/" class="bottom-nav-link {% if request.url.path == '/' %}active{% endif %}">
                        <span class="nav-icon">
                            {% if request.url.path == '/' %}
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M21.591 7.146L12.52 1.157c-.316-.21-.724-.21-1.04 0l-9.071 5.99c-.26.173-.409.456-.409.757v13.183c0 .502.418.913.929.913H9.14c.51 0 .929-.41.929-.913v-7.075h3.909v7.075c0 .502.417.913.928.913h6.165c.511 0 .929-.41.929-.913V7.904c0-.301-.158-.584-.409-.758z"/>
                            </svg>
                            {% else %}
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M21.591 7.146L12.52 1.157c-.316-.21-.724-.21-1.04 0l-9.071 5.99c-.26.173-.409.456-.409.757v13.183c0 .502.418.913.929.913h6.638c.511 0 .929-.41.929-.913v-7.075h3.008v7.075c0 .502.418.913.929.913h6.638c.511 0 .929-.41.929-.913V7.904c0-.301-.158-.584-.409-.758zM20 20l-4.5.01V13c0-.502-.418-.913-.929-.913H9.43c-.511 0-.929.41-.929.913l-.01 7.01H4V8.773l8-5.27 8 5.27V20z"/>
                            </svg>
                            {% endif %}
                        </span>
                        <span>Home</span>
                    </a>
                </li>
                <li>
                    <a href="/posts" class="bottom-nav-link {% if request.url.path == '/posts' %}active{% endif %}">
                        <span class="nav-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M23 3c-6.62-.1-10.38 2.421-13.05 6.03C7.29 12.61 6 17.331 6 22h2c0-1.007.07-2.012.19-3H12c4.1 0 7.48-3.082 7.94-7.054C22.79 10.147 23.17 6.359 23 3zm-7 8h-1.5v2H16c.63-.016 1.2-.08 1.72-.188C16.95 15.24 14.68 17 12 17H8.55c.57-2.512 1.57-4.851 3-6.78 2.16-2.912 5.29-4.911 9.45-5.187C20.95 8.079 19.9 11 16 11zM4 9V6H1V4h3V1h2v3h3v2H6v3H4z"/>
                            </svg>
                        </span>
                        <span>Posts</span>
                    </a>
                </li>
                <li>
                    <a href="/analytics" class="bottom-nav-link {% if request.url.path == '/analytics' %}active{% endif %}">
                        <span class="nav-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M8.75 21V3h2v18h-2zM18 21V8.5h2V21h-2zM4 21l.004-10h2L6 21H4zm9.248 0v-7h2v7h-2z"/>
                            </svg>
                        </span>
                        <span>Analytics</span>
                    </a>
                </li>
                <li>
                    <a href="/settings" class="bottom-nav-link {% if request.url.path == '/settings' %}active{% endif %}">
                        <span class="nav-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M10.54 1.75h2.92l1.57 2.36c.11.17.32.25.53.21l2.53-.59 2.17 2.17-.58 2.54c-.05.2.04.41.21.53l2.36 1.57v2.92l-2.36 1.57c-.17.12-.26.33-.21.53l.58 2.54-2.17 2.17-2.53-.59c-.21-.04-.42.04-.53.21l-1.57 2.36h-2.92l-1.58-2.36c-.11-.17-.32-.25-.52-.21l-2.54.59-2.17-2.17.58-2.54c.05-.2-.03-.41-.21-.53l-2.36-1.57v-2.92L4.1 8.97c.18-.12.26-.33.21-.53L3.73 5.9 5.9 3.73l2.54.59c.2.04.41-.04.52-.21l1.58-2.36zm1.07 2l-.98 1.47c-.51.76-1.43 1.13-2.33.93l-1.6-.37-.79.79.37 1.59c.2.9-.17 1.83-.93 2.33l-1.47.99v1.12l1.47.99c.76.5 1.13 1.43.93 2.33l-.37 1.59.79.79 1.6-.37c.9-.2 1.82.17 2.33.93l.98 1.47h1.12l.98-1.47c.51-.76 1.43-1.13 2.33-.93l1.6.37.79-.79-.37-1.59c-.2-.9.17-1.83.93-2.33l1.47-.99v-1.12l-1.47-.99c-.76-.5-1.13-1.43-.93-2.33l.37-1.59-.79-.79-1.6.37c-.9.2-1.82-.17-2.33-.93l-.98-1.47h-1.12zM12 8c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                            </svg>
                        </span>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    
    <!-- Theme Toggle Script -->
    <script>
        (function() {
            const toggle = document.getElementById('theme-toggle');
            const meta = document.getElementById('theme-color-meta');
            
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                meta.content = theme === 'dark' ? '#000000' : '#ffffff';
            }
            
            toggle.addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme');
                setTheme(current === 'dark' ? 'light' : 'dark');
            });
            
            // Listen for system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                if (!localStorage.getItem('theme')) {
                    setTheme(e.matches ? 'dark' : 'light');
                }
            });
        })();
    </script>
    
    <!-- Timezone conversion utility -->
    <script>
        // Format timestamps to local timezone
        function formatLocalTime(isoString) {
            if (!isoString) return '';
            try {
                const date = new Date(isoString);
                return date.toLocaleString(undefined, {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            } catch (e) {
                return isoString;
            }
        }

        function formatLocalTimeShort(isoString) {
            if (!isoString) return '';
            try {
                const date = new Date(isoString);
                return date.toLocaleString(undefined, {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            } catch (e) {
                return isoString;
            }
        }

        function formatLocalTimeTimeOnly(isoString) {
            if (!isoString) return '';
            try {
                const date = new Date(isoString);
                return date.toLocaleTimeString(undefined, {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
            } catch (e) {
                return isoString;
            }
        }

        // Convert all elements with data-timestamp attribute
        function convertTimestampsToLocal() {
            document.querySelectorAll('[data-timestamp]').forEach(el => {
                const isoString = el.getAttribute('data-timestamp');
                if (isoString) {
                    const format = el.getAttribute('data-time-format') || 'default';
                    let formatted;
                    if (format === 'short') {
                        formatted = formatLocalTimeShort(isoString);
                    } else if (format === 'time-only') {
                        formatted = formatLocalTimeTimeOnly(isoString);
                    } else {
                        formatted = formatLocalTime(isoString);
                    }
                    el.textContent = formatted;
                }
            });
        }

        // Run on page load and after HTMX swaps
        document.addEventListener('DOMContentLoaded', convertTimestampsToLocal);
        document.body.addEventListener('htmx:afterSwap', convertTimestampsToLocal);
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
